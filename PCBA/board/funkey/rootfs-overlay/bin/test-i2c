#!/bin/sh

# Load I2C modules
modprobe i2c-dev
modprobe i2c-mv64xxx

# Look for U1 (PCAL6416 GPIO expander)
U1=$(i2cdetect -y 0 20 20 | grep 20: | cut -d ':' -f 2)
let U1=U1+0
if [ ${U1} -ne 20 ]; then
   echo "ERROR I2C U1"
   exit 1
fi

# Look for U5 (AXP209 PMIC)
U5=$(i2cdetect -y 0 34 34 | grep 30: | cut -d ':' -f 2)
let U5=U5+0
if [ ${U5} -ne 34 ]; then
   echo "ERROR I2C U5"
   exit 1
fi

# Unload I2C modules
modprobe -r i2c_mv64xxx i2c_dev >/dev/null 2>&1
echo "OK"
