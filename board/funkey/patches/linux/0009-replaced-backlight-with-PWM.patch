From c06a4ba80922341138853bf8cedaeef2cd533013 Mon Sep 17 00:00:00 2001
From: Michel Stempin <michel.stempin@wanadoo.fr>
Date: Tue, 19 Mar 2019 22:51:37 +0100
Subject: [PATCH 4/9] replaced backlight with PWM

Signed-off-by: Michel Stempin <michel.stempin@wanadoo.fr>
---
 arch/arm/boot/dts/sun8i-v3s-licheepi-zero-dock.dts      | 6 ++++++
 arch/arm/boot/dts/sun8i-v3s-licheepi-zero-with-lcd.dtsi | 6 +++---
 arch/arm/boot/dts/sun8i-v3s.dtsi                        | 5 +++++
 3 files changed, 14 insertions(+), 3 deletions(-)

diff --git a/arch/arm/boot/dts/sun8i-v3s-licheepi-zero-dock.dts b/arch/arm/boot/dts/sun8i-v3s-licheepi-zero-dock.dts
index 0afd3af..1c263c2 100644
--- a/arch/arm/boot/dts/sun8i-v3s-licheepi-zero-dock.dts
+++ b/arch/arm/boot/dts/sun8i-v3s-licheepi-zero-dock.dts
@@ -79,6 +79,12 @@
 	status = "okay";
 };
 
+&pwm {
+        pinctrl-names = "default";
+        pinctrl-0 = <&pwm0_pins>;
+        status = "okay";
+};
+
 &lradc {
 	vref-supply = <&reg_vcc3v0>;
 	status = "okay";
diff --git a/arch/arm/boot/dts/sun8i-v3s-licheepi-zero-with-lcd.dtsi b/arch/arm/boot/dts/sun8i-v3s-licheepi-zero-with-lcd.dtsi
index b7d8ff4..ad3fb39 100644
--- a/arch/arm/boot/dts/sun8i-v3s-licheepi-zero-with-lcd.dtsi
+++ b/arch/arm/boot/dts/sun8i-v3s-licheepi-zero-with-lcd.dtsi
@@ -7,12 +7,12 @@
 #include "sun8i-v3s-licheepi-zero.dts"
 
 / {
-	backlight: backlight {
+	/*backlight: backlight {
 		compatible = "pwm-backlight";
 		pwms = <&pwm 0 1000000 0>;
 		brightness-levels = <0 30 40 50 60 70 100>;
 		default-brightness-level = <6>;
-	};
+	};*/
 
 	panel: panel {
 		#address-cells = <1>;
@@ -20,7 +20,7 @@
 
 		port@0 {
 			reg = <0>;
-			backlight = <&backlight>;
+			//backlight = <&backlight>;
 			#address-cells = <1>;
 			#size-cells = <0>;
 
diff --git a/arch/arm/boot/dts/sun8i-v3s.dtsi b/arch/arm/boot/dts/sun8i-v3s.dtsi
index 6708af1..a61c680 100644
--- a/arch/arm/boot/dts/sun8i-v3s.dtsi
+++ b/arch/arm/boot/dts/sun8i-v3s.dtsi
@@ -351,6 +351,11 @@
 				function = "pwm0";
 			};
 
+			pwm1_pins: pwm1 {
+				pins = "PB5";
+				function = "pwm1";
+			};
+
 			uart0_pins_a: uart0@0 {
 				pins = "PB8", "PB9";
 				function = "uart0";
-- 
2.7.4

